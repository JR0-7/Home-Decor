{% extends 'admin_templates/base.html' %}
{% load static %}
{% block content %}


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Users List</h2>

        </div>
        <div>
            <!-- <a href="#" class="btn btn-light rounded font-md">Export</a>
                    <a href="#" class="btn btn-light rounded  font-md">Import</a>
                    <a href="#" class="btn btn-primary btn-sm rounded">Create new</a> -->
        </div>
    </div>
    <div class="card mb-4">
        <header class="card-header">
            <div class="row align-items-center">

                <div class="col-md-3 col-12 me-auto mb-md-0 mb-3 ">
                    <form class="searchform">
                        <div class="input-group" style="width: 350px;">
                            <input type="text" class="form-control" placeholder="Search">
                            <button class="btn btn-light bg" type="button"> <i
                                    class="material-icons md-search"></i></button>
                        </div>
                    </form>
                </div>
                <!-- <div>
                    {% if messages %}
                    {% for message in messages %}
                    <span class="error" style="top: 100%;left: 2px;font-size:14px;font-weight: 400;color: red;width: 190px;transition: opacity 0.5s;">{{message}}</span>
                    {% endfor %}
                    {% endif %}
                </div> -->
                <div class="col-md-2 col-6">
                    <input type="date" value="02.05.2021" class="form-control">
                </div>
                <div class="col-md-2 col-6">
                    <select class="form-select">
                        <option selected>Status</option>
                        <option>Active</option>
                        <option>Disabled</option>
                        <option>Show all</option>
                    </select>
                </div>
            </div>
        </header> <!-- card-header end// -->
        <div class="card-body">



            <div class="row align-items-center">

                <table class="table table-hover">
                    <thead>

                        <tr>
                            <th scope="col" class="justify-content-center"
                                style="align-items: center; justify-content: center; align-content:center;">User</th>
                            <th scope="col">Phone Number</th>
                            <!-- <th scope="col">Total Orders</th>
                            <th scope="col">Account Balance</th> -->
                            <th scope="col">Registration Date</th>
                            <th scope="col">Account Status</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>
                                <div class="d-flex flex-row col-name">
                                    <div>

                                        <h6 class="mb-0">{{ user.username }}</h6>
                                        <span>{{ user.email }}</span>

                                    </div>

                                </div>
                            </td>
                            <td>
                                <div class="col-price"> <span>{{ user.phone_number }}</span> </div>
                            </td>
                            <!-- <td>
                                <div class="col-price"> <span>{{ user.first_name }}</span> </div>
                            </td> -->
                            <td>
                                <div class="col-price">{{ user.date_join|date:"d-m-Y" }}</div>
                            </td>
                            <td>

                                {% if user.is_blocked %}
                                <div class="align-items-center col-status">
                                    <span  class="badge rounded-pill alert-danger">Blocked</span>
                                </div>
                                {% elif user.is_active %}
                                <div class="align-items-center col-status">
                                    <span class="badge rounded-pill alert-success">Active</span>
                                </div>
                                {% else %}
                                <div class="align-items-center col-status">
                                    <span class="badge rounded-pill alert-warning">Not active</span>
                                </div>
                                {% endif %}

                            </td>
                            <td>
                                <div class="col">


                                    {% if user.is_blocked %}
                                    <button class="btn  alert-success unblock-user-btn" 
                                    data-user-id="{{ user.id }}">Unblock
                                        User</button>
                                    {% else %}
                                    <button class="btn alert-danger block-user-btn" 
                                    data-user-id="{{ user.id }}">Block
                                        User</button>
                                    {% endif %}
                                </div>
                            </td>


                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

            </div> <!-- card-body end// -->
        </div> <!-- card end// -->
        <div class="pagination-area mt-30 mb-50">
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-start">
                    <li class="page-item active"><a class="page-link" href="#">01</a></li>
                    <li class="page-item"><a class="page-link" href="#">02</a></li>
                    <li class="page-item"><a class="page-link" href="#">03</a></li>
                    <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                    <li class="page-item"><a class="page-link" href="#">16</a></li>
                    <li class="page-item"><a class="page-link" href="#"><i
                                class="material-icons md-chevron_right"></i></a></li>
                </ul>
            </nav>
        </div>
</section> <!-- content-main end// -->


<script>
    // Add this script to your HTML template or a separate JS file

   
        var base_url = "{% url 'adminhome' %}";

        $('.block-user-btn').click(function () {
            var userId = $(this).data('user-id');

            $.ajax({
                url: base_url + 'blockuser/' + userId + '/',
                type: 'GET',  // You can use POST if needed
                success: function (response) {
                    // alert(response.message);
                    location.reload();
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });

        $('.unblock-user-btn').click(function () {
            var userId = $(this).data('user-id');
            $.ajax({
                url: base_url + 'unblockuser/' + userId + '/',
                type: 'GET',  // You can use POST if needed
                success: function (response) {
                    // alert(response.message);
                    location.reload();
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    


   

</script>
{% endblock content %}